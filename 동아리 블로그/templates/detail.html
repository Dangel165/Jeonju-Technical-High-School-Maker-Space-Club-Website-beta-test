<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }} | ì „ì£¼ê³µê³  ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Dotum', 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 0; line-height: 1.6; background: #f4f4f4; color: #333; }
        header { background: #2e8b57; color: #fff; padding: 20px; text-align: center; }
        header h1 { margin: 0; }
        nav ul { list-style: none; margin: 0; padding: 0; display: flex; justify-content: center; }
        nav ul li { margin: 0 15px; }
        nav ul li a { color: #fff; text-decoration: none; font-weight: bold; }
        
        .container { max-width: 800px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        .post-header { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .post-header h2 { color: #2e8b57; margin-top: 0; }
        .post-meta { font-size: 0.9em; color: #777; margin-bottom: 10px; }
        
        .post-content { padding: 20px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; min-height: 150px; white-space: pre-wrap; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .post-actions { margin-top: 20px; text-align: right; }
        .action-btn, .delete-btn { 
            padding: 8px 15px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            text-decoration: none;
            display: inline-block;
            margin-left: 10px;
        }
        .action-btn { background: #ffc107; color: #333; }
        .delete-btn { background: #dc3545; color: white; }

        /* í”Œë˜ì‹œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .flash-message { padding: 10px; margin-bottom: 15px; border-radius: 5px; font-weight: bold; }
        .flash-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .flash-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* ëŒ“ê¸€ ìŠ¤íƒ€ì¼ */
        .comments-section { margin-top: 50px; }
        .comment-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: #fff; }
        .comment-meta { font-size: 0.85em; color: #555; margin-bottom: 5px; }
        .comment-content { margin: 0; }
        .comment-form input[type="text"], .comment-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .comment-form button[type="submit"] {
            background-color: #2e8b57;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* ì‹ ê³  ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .report-section {
            margin-top: 40px; 
            border-top: 1px dashed #ccc; 
            padding-top: 20px;
            background: #ffe0e0;
            padding: 20px;
            border-radius: 5px;
        }
        .report-section h4 { 
            color: #dc3545; 
            margin-top: 0; 
            margin-bottom: 15px; 
            border-bottom: 1px solid #f00; 
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1><a href="{{ url_for('index') }}" style="color: inherit; text-decoration: none;">ì „ì£¼ê³µì—…ê³ ë“±í•™êµ ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤</a></h1>
        <p>í™œë™ ê¸°ë¡ ë° ì •ë³´ ê³µìœ  ë¸”ë¡œê·¸</p>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}#about">ë™ì•„ë¦¬ ì†Œê°œ</a></li>
                <li><a href="{{ url_for('index') }}#activity">í™œë™ ê¸°ë¡</a></li>
                <li><a href="{{ url_for('index') }}#members">ë©¤ë²„ ì†Œê°œ</a></li>
                {% if g.user and g.user.is_member %}
                <li><a href="{{ url_for('write') }}">í™œë™ ê¸°ë¡ ì‘ì„±</a></li>
                <li><a href="{{ url_for('member_login') }}">ë¡œê·¸ì¸ ìƒíƒœ ({{ g.user.id }})</a></li>
                    {% if g.user.is_admin %}
                    <li><a href="{{ url_for('admin_dashboard') }}" style="color: #ffcc00;">â­ ê´€ë¦¬ì ë©”ë‰´ â­</a></li>
                    {% endif %}
                <li><a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></li>
                {% else %}
                <li><a href="{{ url_for('member_login') }}">ë™ì•„ë¦¬ ë¡œê·¸ì¸</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <div class="container">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {% if category == 'success' %}flash-success{% else %}flash-{{ category }}{% endif %}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="post-header">
            <h2>{{ post.title }}</h2>
            <div class="post-meta">
                ì‘ì„±ì: **{{ post.author }}** | 
                ì‘ì„±ì¼: **{{ post.created_at | korean_date_format }}**
            </div>
        </div>

        {% if g.user and g.user.id == post.author %}
        <div class="post-actions">
            <a href="{{ url_for('edit', post_id=post.id) }}" class="action-btn">ìˆ˜ì •</a>
            <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('ì •ë§ë¡œ ì´ í™œë™ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì²¨ë¶€ íŒŒì¼ë„ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.)');" class="delete-btn">ì‚­ì œ</button>
            </form>
        </div>
        {% endif %}

        <div class="post-content">
            
            {% if post.file_path %}
                <div style="margin-bottom: 30px; text-align: center; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #f9f9f9;">
                    {% set filename = post.file_path.split('/')[-1] %}
                    {% set extension = filename.split('.')[-1].lower() %}
                    
                    {% if extension in ['png', 'jpg', 'jpeg', 'gif'] %}
                        <img src="{{ url_for('uploaded_file', filename=filename) }}" alt="ì—…ë¡œë“œ ì´ë¯¸ì§€" style="max-width: 100%; height: auto; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    {% elif extension in ['mp4', 'mov', 'avi'] %}
                        <video controls style="max-width: 100%; height: auto; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <source src="{{ url_for('uploaded_file', filename=filename) }}" type="video/{{ 'mp4' if extension == 'mp4' else ('quicktime' if extension in ['mov','avi'] else 'mp4') }}"> 
                            ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </video>
                    {% else %}
                        <p>ì²¨ë¶€ëœ íŒŒì¼: <a href="{{ url_for('uploaded_file', filename=filename) }}" target="_blank">{{ filename }}</a></p>
                    {% endif %}
                    <small style="display: block; margin-top: 10px; color: #555;">(ì²¨ë¶€ íŒŒì¼)</small>
                </div>
            {% endif %}

            {{ post.content }}
        </div>

        <a href="{{ url_for('index') }}" style="display: block; text-align: center; margin-top: 30px; color: #2e8b57; font-weight: bold;">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        
        <div class="comments-section" style="margin-top: 50px;">
            <h3>ëŒ“ê¸€ ({{ comments|length }})</h3>

            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-meta">
                    <strong>{{ comment.username }}</strong>
                    <span>(**{{ comment.created_at | korean_date_format }}**)</span>
                </div>
                <p class="comment-content">{{ comment.content }}</p>
            </div>
            {% endfor %}

            <div class="comment-form" style="margin-top: 20px;">
                <h4>ëŒ“ê¸€ ì‘ì„±</h4>
                {% if g.user and g.user.is_banned %}
                <p style="color: red; font-weight: bold;">â›” **ì •ì§€ëœ ê³„ì •ì€ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**</p>
                {% else %}
                <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                    <input type="text" name="username" placeholder="ì´ë¦„ (ìƒëµ ì‹œ ìµëª…)" maxlength="20" {% if g.user %} value="{{ g.user.id }}" disabled {% endif %}>
                    <textarea name="content" placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." required></textarea>
                    <button type="submit">ëŒ“ê¸€ ë“±ë¡</button>
                </form>
                {% endif %}
            </div>
        </div>
        
        <div class="report-section">
            <h4>ğŸš¨ ì´ ê²Œì‹œë¬¼/ëŒ“ê¸€ì„ ì‹ ê³ í•˜ê¸°</h4>
            {% if g.user and g.user.is_banned %}
            <p style="color: red; font-weight: bold;">â›” **ì •ì§€ëœ ê³„ì •ì€ ì‹ ê³ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**</p>
            {% else %}
            <form method="POST" action="{{ url_for('report_item', post_id=post.id) }}" style="display: flex; gap: 10px; align-items: center;">
                <input type="hidden" name="reported_content" value="ê²Œì‹œë¬¼ ì œëª©: {{ post.title }}">
                <input type="text" name="reason" placeholder="ì‹ ê³  ì‚¬ìœ ë¥¼ ê°„ëµíˆ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ìš•ì„¤, ê´‘ê³ )" required style="flex-grow: 1; padding: 8px; border: 1px solid #dc3545; border-radius: 4px;">
                <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">ì‹ ê³  ì ‘ìˆ˜</button>
            </form>
            <small style="color: #721c24;">* ì‹ ê³ ëŠ” ê´€ë¦¬ì í™•ì¸ í›„ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì•…ì˜ì ì¸ ì‹ ê³ ëŠ” ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
            {% endif %}
        </div>

    </div>

    <footer>
        <p>&copy; ì „ì£¼ê³µì—…ê³ ë“±í•™êµ ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤ ë™ì•„ë¦¬. All Rights Reserved.</p>
    </footer>
</body>
</html>
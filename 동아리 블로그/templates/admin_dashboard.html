<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | ì „ì£¼ê³µê³  ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 0; line-height: 1.6; background: #f4f4f4; color: #333; }
        header { background: #2e8b57; color: #fff; padding: 20px; text-align: center; }
        header h1 { margin: 0; }
        .container { max-width: 1200px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { color: #2e8b57; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 30px; }
        h3 { color: #dc3545; border-bottom: 1px solid #f00; padding-bottom: 5px; margin-top: 40px;} /* ì‹ ê³  ëª©ë¡ ì œëª© ìŠ¤íƒ€ì¼ */
        
        /* ëŒ€ì‹œë³´ë“œ í†µê³„ ì¹´ë“œ */
        .dashboard-stats { display: flex; gap: 20px; margin-bottom: 40px; }
        .stat-card { flex: 1; padding: 20px; background: #f0f8ff; border-radius: 8px; border: 1px solid #d0e8ff; text-align: center; }
        .stat-card h3 { color: #2e8b57; margin-top: 0; border: none; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; color: #555; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* í”Œë˜ì‹œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .flash-message { padding: 15px; margin-bottom: 20px; border-radius: 8px; font-weight: bold; }
        .flash-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash-error, .flash-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .flash-warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .flash-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        /* â­ [ê°œì„ ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼] â­ */
        
        /* ëª¨ë“  ë²„íŠ¼ì— ì ìš©ë˜ëŠ” ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .button-base { 
            padding: 8px 15px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            margin: 2px 4px;
            text-decoration: none; /* a íƒœê·¸ì—ë„ ì ìš©ë  ìˆ˜ ìˆë„ë¡ */
            display: inline-block; /* a íƒœê·¸ê°€ ë²„íŠ¼ì²˜ëŸ¼ ë³´ì´ë„ë¡ */
            transition: all 0.3s ease; /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* ê¸°ë³¸ ê·¸ë¦¼ì */
        }
        
        /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ íš¨ê³¼ */
        .button-base:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            transform: translateY(-2px); /* ì•½ê°„ ìœ„ë¡œ ì›€ì§ì´ëŠ” íš¨ê³¼ */
        }
        
        /* í´ë¦­ ì‹œ íš¨ê³¼ */
        .button-base:active {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(0);
        }

        /* ê°œë³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì ìš© */
        .reject-btn { 
            background-color: #dc3545; /* ë¶‰ì€ìƒ‰ */
            color: white; 
        }
        .accept-btn { 
            background-color: #28a745; /* ë…¹ìƒ‰ ê³„ì—´ (ìŠ¹ì¸/ì„±ê³µ) */
            color: white; 
        }
        .ban-btn { 
            background-color: #dc3545; /* ë¶‰ì€ìƒ‰ */
            color: white; 
        }
        .unban-btn { 
            background-color: #ffc107; /* ë…¸ë€ìƒ‰ */
            color: #333; 
        }
        .process-btn { 
            background-color: #007bff; /* íŒŒë€ìƒ‰ */
            color: white; 
        }
        
        /* ê¸°ì¡´ button íƒœê·¸ì— button-base í´ë˜ìŠ¤ ì ìš© */
        button {
             /* ê¸°ì¡´ button ìŠ¤íƒ€ì¼ì„ ì´ˆê¸°í™”í•˜ê³  button-baseì— í†µí•© */
             /* ë‹¨, HTML ë§ˆí¬ì—…ì—ì„œ class="button-base"ë¥¼ ì¶”ê°€í•´ì•¼ ì™„ì „íˆ ì ìš©ë©ë‹ˆë‹¤. */
             /* ë˜ëŠ” ì•„ë˜ì²˜ëŸ¼ ê¸°ì¡´ í´ë˜ìŠ¤ì— button-baseë¥¼ ìƒì†í•©ë‹ˆë‹¤. */
             padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; 
             transition: all 0.3s ease;
        }
        
        /* ìµœì¢…ì ìœ¼ë¡œ HTML ë§ˆí¬ì—…ì— class="button-base"ë¥¼ ì¶”ê°€í•´ì•¼ ì™„ë²½íˆ ì ìš©ë©ë‹ˆë‹¤. */
        /* ì•„ë˜ëŠ” ê¸°ì¡´ í´ë˜ìŠ¤ì— ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ì„ ìƒì†ì‹œí‚¤ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. */
        .accept-btn, .reject-btn, .ban-btn, .unban-btn, .process-btn {
            padding: 8px 15px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            margin: 2px 4px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }

        .accept-btn:hover, .reject-btn:hover, .ban-btn:hover, .unban-btn:hover, .process-btn:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            transform: translateY(-2px); 
        }
        
        .accept-btn:active, .reject-btn:active, .ban-btn:active, .unban-btn:active, .process-btn:active {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(0);
        }
        /* â­ [ê°œì„ ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼] ë â­ */


    </style>
</head>
<body>
    <header>
        <h1><a href="{{ url_for('index') }}" style="color: inherit; text-decoration: none;">ì „ì£¼ê³µì—…ê³ ë“±í•™êµ ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤</a></h1>
        <p>â­ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
    </header>

    <div class="container">
        <h2>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ìš”ì•½</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category if category != 'error' else 'danger' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="dashboard-stats">
            <div class="stat-card">
                <h3>ì´ í™œë™ ê¸°ë¡ ìˆ˜</h3>
                <p>{{ post_count }} ê±´</p>
            </div>
            <div class="stat-card">
                <h3>ë¯¸ìŠ¹ì¸ ê°€ì… ì‹ ì²­</h3>
                <p>{{ applications|length }} ê±´</p>
            </div>
            <div class="stat-card" style="background: #ffe0e0;">
                <h3>ğŸš¨ ë¯¸ì²˜ë¦¬ ì‹ ê³ </h3>
                <p style="color: red; font-weight: bold;">{{ reports|length }} ê±´</p> 
            </div>
        </div>

        
        <h2>ğŸ“… ë¯¸ìŠ¹ì¸ ê°€ì… ì‹ ì²­ ëª©ë¡</h2>
        {% if applications %}
        <table>
            <thead>
                <tr>
                    <th>ì‹ ì²­ ID</th>
                    <th>í•™ë²ˆ</th>
                    <th>ì´ë¦„</th>
                    <th>ì‹ ì²­ì¼ (UTC)</th>
                    <th>ì²˜ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td>{{ app.id }}</td>
                    <td>{{ app.student_id }}</td>
                    <td>{{ app.name }}</td>
                    <td>{{ app.applied_at }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('reject_application', app_id=app.id) }}" style="display:inline;">
                            <button type="submit" onclick="return confirm('{{ app.name }}ë‹˜ì˜ ê°€ì… ì‹ ì²­ì„ ê±°ì ˆí•˜ê³  ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="reject-btn">ê±°ì ˆ/ì‚­ì œ</button>
                        </form>
                        <a href="{{ url_for('finalize_member', app_id=app.id) }}" class="accept-btn">ID/PW ì„¤ì • ë° ìŠ¹ì¸</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>í˜„ì¬ ë¯¸ìŠ¹ì¸ëœ ê°€ì… ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤. âœ…</p>
        {% endif %}

        
        <h2>ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬ (ë©¤ë²„)</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ë©¤ë²„ ì—¬ë¶€</th>
                    <th>ë°´ ìƒíƒœ</th> <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>
                        {% if user.is_member %}
                        <span style="color: green; font-weight: bold;">[ë©¤ë²„]</span>
                        {% else %}
                        <span style="color: orange;">[ì¼ë°˜]</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="color: {{ 'red' if user.is_banned else 'green' }}; font-weight: bold;">
                            {{ 'â›” ì •ì§€ë¨' if user.is_banned else 'ğŸŸ¢ ì •ìƒ' }}
                        </span>
                    </td>
                    <td>
                        {% if user.id != g.user.id and user.id != 'makerspace_jj' %} 
                            {% if user.is_banned %}
                                <form method="POST" action="{{ url_for('unban_user', user_id=user.id) }}" style="display:inline;">
                                    <button type="submit" onclick="return confirm('{{ user.id }} ê³„ì •ì˜ ì •ì§€ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="unban-btn">ì •ì§€ í•´ì œ</button>
                                </form>
                            {% else %}
                                <form method="POST" action="{{ url_for('ban_user', user_id=user.id) }}" style="display:inline;">
                                    <button type="submit" onclick="return confirm('{{ user.id }} ê³„ì •ì„ ì •ì§€ì‹œí‚¤ê² ìŠµë‹ˆê¹Œ? ì •ì§€ëœ ì‚¬ìš©ìëŠ” ê¸€ì“°ê¸°/ëŒ“ê¸€/ë¡œê·¸ì¸(ì¬ë¡œê·¸ì¸ì‹œ)ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.');" class="ban-btn">ê³„ì • ì •ì§€</button>
                                </form>
                            {% endif %}
                        {% else %}
                            (ê´€ë¦¬ ë¶ˆê°€)
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        
        <h3>ğŸš¨ ë¯¸ì²˜ë¦¬ ì‹ ê³  ëª©ë¡ ({{ reports|length }}ê±´)</h3>
        {% if reports %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ì‹ ê³ ì</th>
                    <th>ëŒ€ìƒ (ID)</th>
                    <th>ì‹ ê³  ì‚¬ìœ </th>
                    <th>ì‹ ê³  ë‚´ìš© (ëŒ€ìƒ)</th>
                    <th>ì‹ ê³ ì¼ (UTC)</th>
                    <th>ì²˜ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.id }}</td>
                    <td>{{ report.reporter_id }}</td>
                    <td>{{ report.reported_type }} ({{ report.reported_id }})</td>
                    <td style="color: red; font-weight: bold;">{{ report.reason }}</td>
                    <td style="max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ report.reported_content }}</td>
                    <td>{{ report.reported_at }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('process_report', report_id=report.id) }}" style="display:inline;">
                            <button type="submit" onclick="return confirm('ì´ ì‹ ê³ ë¥¼ ì²˜ë¦¬ ì™„ë£Œë¡œ í‘œì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)');" class="process-btn">ì²˜ë¦¬ ì™„ë£Œ</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>í˜„ì¬ ë¯¸ì²˜ë¦¬ëœ ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸŸ¢</p>
        {% endif %}
        
        
        <h2>ìµœê·¼ í™œë™ ê°ì‚¬ ë¡œê·¸ (Audit Logs)</h2>
        <small style="display: block; margin-bottom: 10px; color: #888;">ìµœê·¼ ë¡œê·¸ì¸ ë° ì£¼ìš” í™œë™ì„ ê¸°ë¡í•©ë‹ˆë‹¤. (IP ì£¼ì†Œ í¬í•¨)</small>
        <table>
            <thead>
                <tr>
                    <th>ì‹œê°„ (UTC)</th>
                    <th>ì‚¬ìš©ì ID</th>
                    <th>í™œë™ ìœ í˜•</th>
                    <th>í¬ìŠ¤íŠ¸ ID</th>
                    <th>IP ì£¼ì†Œ</th>
                    <th>ì„¸ë¶€ ì‚¬í•­</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.timestamp }}</td> 
                    <td>{{ log.user_id }}</td>
                    <td>{{ log.action }}</td>
                    <td>{{ log.post_id if log.post_id is not none else '-' }}</td>
                    <td>{{ log.ip_address }}</td>
                    <td>{{ log.details if log.details is not none else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <a href="{{ url_for('index') }}" style="display: block; text-align: center; margin-top: 30px; color: #2e8b57; font-weight: bold;">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <footer>
        <p>&copy; ì „ì£¼ê³µì—…ê³ ë“±í•™êµ ë©”ì´ì»¤ ìŠ¤í˜ì´ìŠ¤ ë™ì•„ë¦¬. All Rights Reserved.</p>
    </footer>
</body>
</html>
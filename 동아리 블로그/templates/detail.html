<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }} | 전주공고 메이커 스페이스</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Dotum', 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 0; line-height: 1.6; background: #f4f4f4; color: #333; }
        header { background: #2e8b57; color: #fff; padding: 20px; text-align: center; }
        header h1 { margin: 0; }
        nav ul { list-style: none; margin: 0; padding: 0; display: flex; justify-content: center; }
        nav ul li { margin: 0 15px; }
        nav ul li a { color: #fff; text-decoration: none; font-weight: bold; }
        
        .container { max-width: 800px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        .post-header { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .post-header h2 { color: #2e8b57; margin-top: 0; font-size: 2.5em; text-align: left; }
        .post-meta { font-size: 0.9em; color: #888; margin-top: 5px; }
        .post-content { white-space: pre-wrap; margin-bottom: 40px; } /* 줄바꿈 유지 */

        .post-actions { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px; }
        .post-actions a, .post-actions button { 
            padding: 8px 15px; 
            border-radius: 5px; 
            text-decoration: none; 
            font-weight: bold; 
            transition: background 0.3s;
            cursor: pointer;
            border: none;
        }
        .edit-btn { background: #4682b4; color: white; }
        .edit-btn:hover { background: #3a6a90; }
        .delete-btn { background: #d9534f; color: white; }
        .delete-btn:hover { background: #b54541; }

        /* 댓글 스타일 */
        .comments-section h3 { border-bottom: 1px solid #ddd; padding-bottom: 10px; color: #2e8b57; }
        .comment-item { border-bottom: 1px dashed #eee; padding: 10px 0; }
        .comment-item:last-child { border-bottom: none; }
        .comment-meta { font-size: 0.85em; color: #666; margin-bottom: 5px; }
        .comment-content { margin: 0; }

        .comment-form textarea { width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        .comment-form input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        .comment-form button { background: #3cb371; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .comment-form button:hover { background: #2e8b57; }

        footer { text-align: center; padding: 20px; background: #2e8b57; color: white; margin-top: 50px; font-size: 0.8em; }
    </style>
</head>
<body>
    <header>
        <h1><a href="{{ url_for('index') }}" style="color: inherit; text-decoration: none;">전주공업고등학교 메이커 스페이스</a></h1>
        <p>활동 기록 및 정보 공유 블로그</p>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}#about">동아리 소개</a></li>
                <li><a href="{{ url_for('index') }}#activity">활동 기록</a></li>
                <li><a href="{{ url_for('index') }}#members">멤버 소개</a></li>
                <!-- 이전에 수정된 부분: member_login_page -> member_login -->
                <li><a href="{{ url_for('member_login') }}">동아리 로그인</a></li>
                
                {% if g.user %}
                <li><a href="{{ url_for('logout') }}">로그아웃</a></li>
                {% else %}
                <!-- [BUILD ERROR FIX APPLIED HERE] login_page -> login 으로 수정 -->
                <li><a href="{{ url_for('login') }}">일반 로그인</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <div class="container">
        
        <!-- Flash 메시지 표시 -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div style="padding: 10px; margin-bottom: 20px; border-radius: 5px; background: {% if category == 'error' %}#f8d7da{% elif category == 'success' %}#d4edda{% else %}#fff3cd{% endif %}; color: {% if category == 'error' %}#721c24{% elif category == 'success' %}#155724{% else %}#856404{% endif %}; border: 1px solid {% if category == 'error' %}#f5c6cb{% elif category == 'success' %}#c3e6cb{% else %}#ffeeba{% endif %};">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="post-header">
            <h2>{{ post.title }}</h2>
            <div class="post-meta">
                <span>작성자: {{ post.author }}</span> | 
                <span>작성일: {{ post.created_at.strftime('%Y년 %m월 %d일 %H:%M') }}</span>
            </div>
        </div>

        <!-- 수정/삭제 버튼 (동아리 멤버에게만 표시) -->
        {% if g.user and g.user.is_member %}
        <div class="post-actions">
            <a href="{{ url_for('edit', post_id=post.id) }}" class="edit-btn">수정</a>
            <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" onsubmit="return confirm('정말로 이 활동 기록을 삭제하시겠습니까?');" style="margin: 0;">
                <button type="submit" class="delete-btn">삭제</button>
            </form>
        </div>
        {% endif %}

        <div class="post-content">
            {{ post.content }}
        </div>

        <a href="{{ url_for('index') }}" style="display: block; text-align: center; margin-top: 30px; color: #2e8b57; font-weight: bold;">← 목록으로 돌아가기</a>
        
        <!-- 댓글 섹션 -->
        <div class="comments-section" style="margin-top: 50px;">
            <h3>댓글 ({{ comments|length }})</h3>

            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-meta">
                    <strong>{{ comment.username }}</strong>
                    <span>({{ comment.created_at.strftime('%Y-%m-%d %H:%M') }})</span>
                </div>
                <p class="comment-content">{{ comment.content }}</p>
            </div>
            {% endfor %}

            <!-- 댓글 작성 폼 -->
            <div class="comment-form" style="margin-top: 20px;">
                <h4>댓글 작성</h4>
                <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                    <input type="text" name="username" placeholder="이름 (생략 시 익명)" maxlength="20">
                    <textarea name="content" placeholder="댓글 내용을 입력해 주세요." required></textarea>
                    <button type="submit">댓글 등록</button>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 전주공업고등학교 메이커 스페이스 동아리. All Rights Reserved.</p>
    </footer>
</body>
</html>